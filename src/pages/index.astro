---
import Navbar from '../components/Navbar.astro';
import FactionHeading from '../components/FactionHeading.astro';

type Unit = {
  slug: string;
  title: string;
  type: string;
  image: string;
  counterpart?: string;
  description: string;
  metalCost: number;
  energyCost: number;
  buildTime: number;
  health: number;
  sightRange: number;
  speed: number;
  weapons: string;
  dps: number;
  weaponRange: number;
  techLevel: number;
};

// ✅ Correct path: same as used in [type].astro
const unitFiles = import.meta.glob<{ frontmatter: Unit }>('../pages/units/*.md', { eager: true });
const units: Unit[] = Object.values(unitFiles).map(mod => mod.frontmatter);

// ✅ Group by type and sort each group by metal cost
const grouped = new Map<string, Unit[]>();
for (const unit of units) {
  if (!grouped.has(unit.type)) grouped.set(unit.type, []);
  grouped.get(unit.type)?.push(unit);
}
for (const [type, unitList] of grouped) {
  unitList.sort((a, b) => a.metalCost - b.metalCost);
}
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Legion Units</title>
    <style>
      .unit-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.75rem;
        justify-items: center;
      }

      .unit-card {
        background-color: #1a1a1a;
        padding: 0rem;
        border-radius: 10px;
        transition: transform 0.2s ease;
        width: 100%;
        max-width: 200px;
      }

      .unit-card:hover {
        transform: scale(1.05);
      }

      .unit-card img {
        width: 100%;
        height: auto;
        display: block;
        border-radius: 8px;
      }
    </style>
  </head>

  <body style="font-family: sans-serif; background-color: #111; color: #eee; margin: 0;">
    <div style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
      <!-- Green "Units" heading using same shared component -->
      <FactionHeading faction="Legion" type="Units" />
      <Navbar />

      {Array.from(grouped.entries()).map(([type, unitList]) => (
        <>
          <h2 style="margin-top: 2rem; color: #0f0; border-bottom: 1px solid #333; padding-bottom: 0.25rem;">
            {type}
          </h2>
          <div class="unit-grid">
            {unitList.map(unit => (
              <a href={`/units/${unit.slug}`} class="unit-card">
                <img src={unit.image} alt={unit.title} />
              </a>
            ))}
          </div>
        </>
      ))}
    </div>
  </body>
</html>
